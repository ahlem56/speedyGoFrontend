<div class="container mt-5">
  <div class="row mb-5">
    <div class="col-12 text-center">
      <h1 class="page-title">Commission Management</h1>
      <p class="page-subtitle">Manage your partner commissions with ease and style.</p>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-lg-6">
      <mat-card class="card-creative">
        <mat-card-header class="card-header-gradient">
          <mat-card-title>Create New Commission</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="commissionForm" (ngSubmit)="createCommission()">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Partner</mat-label>
              <mat-select formControlName="partnerId">
                <mat-option *ngFor="let partner of partners" [value]="partner.partnerId">
                  {{ partner.partnerName }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="commissionForm.get('partnerId')?.hasError('required')">
                Partner is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Amount</mat-label>
              <input matInput type="number" formControlName="amount">
              <mat-error *ngIf="commissionForm.get('amount')?.hasError('required')">
                Amount is required
              </mat-error>
              <mat-error *ngIf="commissionForm.get('amount')?.hasError('min')">
                Must be greater than 0
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" rows="3"></textarea>
            </mat-form-field>

            <div class="text-end">
              <button mat-flat-button color="accent" type="submit" [disabled]="!commissionForm.valid || isCreating">
                <mat-spinner diameter="20" *ngIf="isCreating"></mat-spinner>
                <span *ngIf="!isCreating">Create Commission</span>
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="col-lg-6">
      <mat-card class="card-creative bg-gradient-light">
        <mat-card-header class="card-header-gradient">
          <mat-card-title>Commission Summary</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="summary-item">
            <span>Total Commissions</span>
            <strong>{{ commissions.length }}</strong>
          </div>
          <div class="summary-item">
            <span>Total Amount</span>
            <strong>{{ commissions | sum:'amount' | currency }}</strong>
          </div>
          <div class="summary-item">
            <span>Pending Payouts</span>
            <strong>{{ commissions | filter:'paidOut':false | sum:'amount' | currency }}</strong>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <div class="row mt-5">
    <div class="col-12">
      <mat-card class="card-creative">
        <mat-card-header class="card-header-gradient">
          <mat-card-title>All Commissions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="table-responsive">
            <table mat-table [dataSource]="commissions" class="commission-table">
              <ng-container matColumnDef="commissionId">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let commission">{{ commission.commissionId }}</td>
              </ng-container>

              <ng-container matColumnDef="partnerName">
                <th mat-header-cell *matHeaderCellDef>Partner</th>
                <td mat-cell *matCellDef="let commission">{{ commission.partnerName || 'N/A' }}</td>
              </ng-container>

              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Amount</th>
                <td mat-cell *matCellDef="let commission">{{ commission.amount | currency }}</td>
              </ng-container>

              <ng-container matColumnDef="calculatedAt">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let commission">{{ commission.calculatedAt | date:'medium' }}</td>
              </ng-container>

              <ng-container matColumnDef="paidOut">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let commission">
                  <span class="badge" [class.badge-paid]="commission.paidOut" [class.badge-pending]="!commission.paidOut">
                    {{ commission.paidOut ? 'Paid' : 'Pending' }}
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef>Description</th>
                <td mat-cell *matCellDef="let commission">{{ commission.description || 'N/A' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>

          <div *ngIf="isLoading" class="text-center my-4">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Loading commissions...</p>
          </div>

          <div *ngIf="!isLoading && commissions.length === 0" class="text-center my-4">
            <p>No commissions found.</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>