<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h2>Commission Management</h2>
    </div>
  </div>

  <!-- Create Commission Form -->
  <div class="row mt-4">
    <div class="col-md-6">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Create New Commission</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="commissionForm" (ngSubmit)="createCommission()">
            <div class="mb-3">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Partner</mat-label>
                <mat-select formControlName="partnerId">
                  <mat-option *ngFor="let partner of partners" [value]="partner.partnerId">
                    {{ partner.partnerName }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="commissionForm.get('partnerId')?.hasError('required')">
                  Partner is required
                </mat-error>
              </mat-form-field>
            </div>

            <div class="mb-3">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Amount</mat-label>
                <input matInput type="number" step="0.01" formControlName="amount">
                <mat-error *ngIf="commissionForm.get('amount')?.hasError('required')">
                  Amount is required
                </mat-error>
                <mat-error *ngIf="commissionForm.get('amount')?.hasError('min')">
                  Amount must be greater than 0
                </mat-error>
              </mat-form-field>
            </div>

            <div class="mb-3">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Description (Optional)</mat-label>
                <textarea matInput formControlName="description" rows="3"></textarea>
              </mat-form-field>
            </div>

            <button mat-raised-button color="primary" type="submit" [disabled]="!commissionForm.valid || isCreating">
              <mat-spinner diameter="20" *ngIf="isCreating"></mat-spinner>
              <span *ngIf="!isCreating">Create Commission</span>
            </button>
          </form>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="col-md-6">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Commission Summary</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Total Commissions: {{ commissions.length }}</p>
          <p>Total Amount: {{ commissions | sum:'amount' | currency }}</p>
          <p>Pending Payouts: {{ commissions | filter:'paidOut':false | sum:'amount' | currency }}</p>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Commissions Table -->
  <div class="row mt-4">
    <div class="col-12">
      <mat-card>
        <mat-card-header>
          <mat-card-title>All Commissions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="table-responsive">
            <table mat-table [dataSource]="commissions" class="w-100">
              <!-- Commission ID Column -->
              <ng-container matColumnDef="commissionId">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let commission">{{ commission.commissionId }}</td>
              </ng-container>

              <!-- Partner Name Column -->
              <ng-container matColumnDef="partnerName">
                <th mat-header-cell *matHeaderCellDef>Partner</th>
                <td mat-cell *matCellDef="let commission">{{ commission.partner?.partnerName || 'N/A' }}</td>
              </ng-container>

              <!-- Amount Column -->
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Amount</th>
                <td mat-cell *matCellDef="let commission">{{ commission.amount | currency }}</td>
              </ng-container>

              <!-- Calculated At Column -->
              <ng-container matColumnDef="calculatedAt">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let commission">{{ commission.calculatedAt | date:'medium' }}</td>
              </ng-container>

              <!-- Paid Out Column -->
              <ng-container matColumnDef="paidOut">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let commission">
                  <span [class]="commission.paidOut ? 'badge bg-success' : 'badge bg-warning'">
                    {{ commission.paidOut ? 'Paid' : 'Pending' }}
                  </span>
                </td>
              </ng-container>

              <!-- Description Column -->
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef>Description</th>
                <td mat-cell *matCellDef="let commission">{{ commission.description || 'N/A' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>

          <div *ngIf="isLoading" class="text-center my-4">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Loading commissions...</p>
          </div>

          <div *ngIf="!isLoading && commissions.length === 0" class="text-center my-4">
            <p>No commissions found.</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div> 